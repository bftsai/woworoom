import{a as p}from"./config-6e92e3cc.js";const m={name(a){const e=new RegExp("[A-Za-z一-龥\\x20]"),n=a.split(e);for(let t=0;t<n.length;t++)if(n[t]!=="")return!1;return!0},phone(a){return new RegExp("^09[0-9]{8}$").test(a)},mail(a){return new RegExp("^[\\w]+@[\\w]+\\.[\\w]{3,6}(\\.[\\w]{2,6})?$").test(a)},address(a){return a!==""}};function S(a,e,n,t){if(m.name(a.value)&&m.phone(e.value)&&m.mail(n.value)&&m.address(t.value))return!0}const f=document.querySelector(".productWrap"),c=document.querySelector(".shoppingCart-table"),L={data:[],async init(){this.data=await p.getProduct(),this.data.length!==0&&this.renderProductWrap(),this.data=await p.getShoppingCar(),this.data.length===0?c.classList.add("d-none"):this.data.length!==0&&(console.log(this.data),c.classList.remove("d-none"),this.renderShoppingCart())},renderProductWrap(){f.innerHTML="",this.data.forEach(a=>{const e=document.createElement("li");e.className="productCard",f.appendChild(e);const n=document.createElement("h4");n.className="productType",n.textContent="新品";const t=document.createElement("img");t.src=a.images,t.alt="product pic";const r=document.createElement("a");r.className="addCardBtn",r.textContent="加入購物車",r.href="#",r.setAttribute("data-id",a.id);const g=document.createElement("h3");g.textContent=a.title;const h=document.createElement("del");h.className="originPrice",h.textContent=a.origin_price;const u=document.createElement("p");u.className="nowPrice",u.textContent=a.price,e.appendChild(n),e.appendChild(t),e.appendChild(r),e.appendChild(g),e.appendChild(h),e.appendChild(u),r.addEventListener("click",async v=>{v.preventDefault();const d=v.target.getAttribute("data-id");r.offsetParent.parentElement.previousElementSibling.previousElementSibling.classList.remove("d-none"),await p.addShoppingCar(d,1),this.data=await p.getShoppingCar(),r.offsetParent.parentElement.previousElementSibling.previousElementSibling.classList.add("d-none"),this.data.length===0?c.classList.add("d-none"):this.data.length!==0&&(c.classList.remove("d-none"),this.renderShoppingCart())})})},async filterProduct(a){const e=await p.getProduct();let n=[];a==="全部"?this.data=e:(e.forEach(t=>{t.category===a&&n.push(t)}),this.data=n),this.renderProductWrap()},renderShoppingCart(){c.innerHTML="";let a=0;if(this.data.forEach(e=>{const n=document.createElement("tr");c.appendChild(n);let t=document.createElement("td");n.appendChild(t);const r=document.createElement("div");r.className="cardItem-title",t.appendChild(r);const g=document.createElement("img");g.src=e.product.images,g.alt="product pic";const h=document.createElement("p");h.textContent=e.product.title,r.appendChild(g),r.appendChild(h),t=document.createElement("td"),t.textContent=e.product.price,n.appendChild(t),t=document.createElement("td"),n.appendChild(t);const u=document.createElement("input");u.value=e.quantity,u.type="number",u.setAttribute("data-id",e.id),t.appendChild(u),t=document.createElement("td"),t.textContent=`NT$${e.product.price*e.quantity}`,n.appendChild(t),a+=e.product.price*e.quantity,t=document.createElement("td"),t.className="discardBtn",n.appendChild(t);const v=document.createElement("a");v.href="#",v.className="material-icons",v.textContent="clear",v.setAttribute("data-id",e.id),t.appendChild(v),u.addEventListener("keyup",async d=>{c.previousElementSibling.classList.remove("d-none"),d.target.value<=1?d.target.value=1:d.target.value=d.target.value.replace(/[^\d.]/g," ");const E=d.target.getAttribute("data-id");this.data=await p.patchShoppingCar(E,Number(d.target.value)),await this.renderShoppingCart(),c.previousElementSibling.classList.add("d-none")}),u.addEventListener("change",async d=>{c.previousElementSibling.classList.remove("d-none"),d.target.value<=1?d.target.value=1:u.value=d.target.value.replace(/[^\d.]/g," ");const E=d.target.getAttribute("data-id");this.data=await p.patchShoppingCar(E,Number(d.target.value)),await this.renderShoppingCart(),c.previousElementSibling.classList.add("d-none")}),v.addEventListener("click",async d=>{d.preventDefault();const E=d.target.getAttribute("data-id");v.parentElement.parentElement.parentElement.previousElementSibling.classList.remove("d-none"),await p.deleteShoppingCarById(E),this.data=await p.getShoppingCar(),v.parentElement.parentElement.parentElement.previousElementSibling.classList.add("d-none"),this.data.length===0?c.classList.add("d-none"):this.data.length!==0&&(console.log(this.data),c.classList.remove("d-none"),this.renderShoppingCart())})}),this.data.length!==0){const e=document.createElement("tr");c.appendChild(e);let n=document.createElement("td");e.appendChild(n);const t=document.createElement("a");t.href="#",t.className="discardAllBtn",t.textContent="刪除所有品項",n.appendChild(t),n=document.createElement("td"),e.appendChild(n),n=document.createElement("td"),e.appendChild(n),n=document.createElement("td"),e.appendChild(n);const r=document.createElement("p");r.textContent="總金額",n.appendChild(r),n=document.createElement("td"),n.textContent=`NT$${a}`,e.appendChild(n),t.addEventListener("click",async g=>{g.preventDefault(),t.parentElement.parentElement.parentElement.previousElementSibling.classList.remove("d-none"),this.data=await p.deleteAllShoppingCar(),t.parentElement.parentElement.parentElement.previousElementSibling.classList.add("d-none"),this.renderShoppingCart()})}},async postOrder(a){await p.postOrder(a),this.data=await p.getShoppingCar(),this.data.length===0?c.classList.add("d-none"):this.data.length!==0&&(console.log(this.data),c.classList.remove("d-none"),this.renderShoppingCart())}};L.init();const x=document.querySelector(".productSelect");x.addEventListener("change",a=>{const e=a.target.value;L.filterProduct(e)});const C=document.querySelector(".orderInfo-btn"),b=document.querySelector(".orderInfo-form"),l=document.getElementById("customerName"),i=document.getElementById("customerPhone"),s=document.getElementById("customerEmail"),o=document.getElementById("customerAddress"),y=document.getElementById("tradeWay");C.addEventListener("click",async a=>{if(a.preventDefault(),b.classList.add("was-validated"),l.value===""?l.classList.add("is-invalid"):m.name(l.value)?l.classList.remove("is-invalid"):(l.classList.add("is-invalid"),l.nextElementSibling.textContent="姓名不得為數字或特殊標點符號，如：!、@、#、$、%、^、&、*"),l.addEventListener("keyup",e=>{l.value===""?(l.classList.add("is-invalid"),l.nextElementSibling.textContent="必填"):m.name(l.value)?l.classList.remove("is-invalid"):(l.classList.add("is-invalid"),l.nextElementSibling.textContent="姓名不得為數字或特殊標點符號，如：!、@、#、$、%、^、&、*")}),l.addEventListener("paste",e=>{l.value===""?(l.classList.add("is-invalid"),l.nextElementSibling.textContent="必填"):m.name(l.value)?l.classList.remove("is-invalid"):(l.classList.add("is-invalid"),l.nextElementSibling.textContent="姓名不得為數字或特殊標點符號，如：!、@、#、$、%、^、&、*")}),i.value===""?(i.classList.add("is-invalid"),i.nextElementSibling.textContent="必填"):m.phone(i.value)?i.classList.remove("is-invalid"):(i.classList.add("is-invalid"),i.nextElementSibling.textContent="電話格式錯誤，請輸入格式為0912345678"),i.addEventListener("keyup",e=>{i.value===""?(i.classList.add("is-invalid"),i.nextElementSibling.textContent="必填"):m.phone(i.value)?i.classList.remove("is-invalid"):(i.classList.add("is-invalid"),i.nextElementSibling.textContent="電話格式錯誤，請輸入格式為0912345678")}),i.addEventListener("paste",e=>{i.value===""?(i.classList.add("is-invalid"),i.nextElementSibling.textContent="必填"):m.phone(i.value)?i.classList.remove("is-invalid"):(i.classList.add("is-invalid"),i.nextElementSibling.textContent="電話格式錯誤，請輸入格式為0912345678")}),s.value===""?(s.classList.add("is-invalid"),s.nextElementSibling.textContent="必填"):m.mail(s.value)?s.classList.remove("is-invalid"):(s.classList.add("is-invalid"),s.nextElementSibling.textContent="Email格式錯誤，請輸入格式為test@mail.com"),s.addEventListener("keyup",e=>{s.value===""?(s.classList.add("is-invalid"),s.nextElementSibling.textContent="必填"):m.mail(s.value)?s.classList.remove("is-invalid"):(s.classList.add("is-invalid"),s.nextElementSibling.textContent="Email格式錯誤，請輸入格式為test@mail.com")}),s.addEventListener("paste",e=>{s.value===""?(s.classList.add("is-invalid"),s.nextElementSibling.textContent="必填"):m.mail(s.value)?s.classList.remove("is-invalid"):(s.classList.add("is-invalid"),s.nextElementSibling.textContent="Email格式錯誤，請輸入格式為test@mail.com")}),o.value===""?(o.classList.add("is-invalid"),o.nextElementSibling.textContent="必填"):o.classList.remove("is-invalid"),o.addEventListener("keyup",e=>{o.value===""?(o.classList.add("is-invalid"),o.nextElementSibling.textContent="必填"):o.classList.remove("is-invalid")}),o.addEventListener("paste",e=>{o.value===""?(o.classList.add("is-invalid"),o.nextElementSibling.textContent="必填"):o.classList.remove("is-invalid")}),S(l,i,s,o)){let e={};e.data={},e.data.user={},e.data.user.name=l.value,e.data.user.tel=i.value,e.data.user.email=s.value,e.data.user.address=o.value,e.data.user.payment=y.value,C.form.previousElementSibling.previousElementSibling.classList.remove("d-none"),await L.postOrder(e),C.form.previousElementSibling.previousElementSibling.classList.add("d-none"),location.href=indexHtml}});
